{% load gwml2_forms %}
{% load i18n %}
<div id="well_metadata" class="page-section">
    <h2 class="section-title">{% trans "Metadata" %}</h2>
    <div class="section">
        <table>
            <tr>
                <td>
                    <h4>{% trans "Data log" %}</h4>
                </td>
            </tr>
            {% field_as_row form.organisation %}
            {% field_as_row form.created_by %}
            {% field_as_row form.created_at %}
            {% field_as_row form.last_edited_by %}
            {% field_as_row form.last_edited_at %}
            <tr>
                <td>
                    <br><br>
                    <h4>{% trans "Permissions" %}</h4>
                </td>
            </tr>
            <tr class="input-column">
                <td>
                    {% trans "Who can view?" %} {% render_help_text form.public %}
                </td>
                <td>
                    <div class="input">
                        <div class="public-input" style="float: left; margin-right: 8px;">{{ form.public }}</div>
                        <div class="public-indicator" style="padding-top: 5px;">
                            <span>{% trans "Anyone" %}</span>
                        </div>
                    </div>
                </td>
            </tr>
            <tr class="input-column">
                <td>
                    {% trans "Is it downloadable?" %} {% render_help_text form.downloadable %}
                </td>
                <td>
                    <div class="input">
                        <div class="downloadable-input" style="float: left; margin-right: 8px;">{{ form.downloadable }}</div>
                        <div class="downloadable-indicator" style="padding-top: 5px;">
                            <span>{% trans "Downloadable" %}</span>
                        </div>
                    </div>
                </td>
            </tr>
            {% field_as_row form.license %}
            {% field_as_row form.restriction_code_type %}
            {% field_as_row form.constraints_other %}
        </table>
    </div>
</div>

<script>
    submitFunctions['well_metadata'] = function () {
        let data = {}
        $('#well_metadata').find('input:enabled,textarea:enabled,select:enabled').each(
            function () {
                const key = $(this).attr('name');
                let value = $(this).val()
                if ($(this).attr('type') === 'checkbox') {
                    value = $(this).is(":checked")
                }
                data[key] = value
            });
        return data
    }
</script>
